<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrarse</title>
    <link rel="stylesheet" href="styler.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="shortcut icon" href="Images html/logo pestaña.png">
</head>
<body>
    <header class="headerlogin">
        <img src="Images html/LogoLH.png" alt="Logo">
        <div>
            <p>¿Ya tienes una cuenta?</p>
            <button onclick="window.location.href='inicio.html'">Iniciar sesión</button>
        </div>
    </header>
    <div class="container">
        <div class="form-container">
            <h1>Registrarse</h1>
            <form id="registerForm">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="nombre" placeholder="Nombre" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="apellido" placeholder="Apellido" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="email" placeholder="Dirección de email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="password" placeholder="Contraseña" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="confirmPassword" placeholder="Confirmar contraseña" required>
                </div>
                <div class="radio-group">
                    <input type="radio" id="alumno" name="role" value="alumno" required>
                    <label for="alumno">Alumno</label>
                    <input type="radio" id="profesor" name="role" value="profesor" required>
                    <label for="profesor">Profesor</label>
                </div>
                <button class="btn">Siguiente</button>
            </form>
        </div>
    </div>


    <div class="datos-profesor" style="display: none;">
        <h1>Datos personales - Profesor</h1>
        <form id="formProfesor">
            <!-- Aquí van los inputs adicionales del profesor -->
            <div class="input-group">
                <i class="fas fa-calendar"></i>
                <input type="date" id="fecha_de_nacimiento_profesor" placeholder="Fecha de nacimiento" required>
            </div>
            <div class="input-group">
                <i class="fas fa-phone"></i>
                <input type="tel" id="telefono_profesor" placeholder="Número de teléfono" required>
            </div>
            <div class="input-group">
                <i class="fas fa-map-marker"></i>
                <select id="pais_profesor" required>
                </select>
            </div>
            <div class="input-group">
                <i class="fas fa-graduation-cap"></i>
                <select id="materias_profesor" required> 
                </select> 
            </div>
            <p>Agrega certificados de tus estudios</p>
            <input type="file" id="certificadoestudio_profesor" required>
            <p>Agrega una foto de perfil</p>
            <input type="file" id="foto_profesor" required accept=".png, .jpg, .jpeg">
            <input type="submit" class="btn" value="Finalizar">
        </form>
    </div>
    <!-- Formulario extra para alumnos -->
    <div class="datos-alumno" style="display: none;">
        <h1>Datos personales - Alumno</h1>
        <form id="formAlumno">
            <!-- Aquí van los inputs adicionales del alumno -->
            <div class="input-group">
                <i class="fas fa-calendar"></i>
                <input type="date" id="fecha_de_nacimiento_alumno" placeholder="Fecha de nacimiento" required>
            </div>
            <div class="input-group">
                <i class="fas fa-phone"></i>
                <input type="tel" id="telefono_alumno" placeholder="Número de teléfono" required>
            </div>
            <div class="input-group">
                <i class="fas fa-map-marker"></i>
                <select id="pais_alumno" required>
                </select>
            </div>
            <div class="input-group">
                <i class="fas fa-graduation-cap"></i>
                <input type="text" id="colegio_alumno" placeholder="Colegio-Universidad" required>
            </div>
            <p>Agrega una foto de perfil</p>
            <input type="file" id="foto_alumno" required accept=".png, .jpg, .jpeg">
            <input type="submit" class="btn" value="Finalizar">
        </form>
    </div>

    <script>
        // Función para cargar los países en el select
        async function cargarPaises() {
            try {
                const response = await fetch('https://learn-hub-eta.vercel.app/paises');
                const paises = await response.json();
                
                const selectPaisProfesor = document.getElementById('pais_profesor');
                const selectPaisAlumno = document.getElementById('pais_alumno');
    
                // Llenar el select de países para profesores
                paises.forEach(pais => {
                    const option = document.createElement('option');
                    option.value = pais.id; // Asumiendo que el ID es la propiedad que necesitas
                    option.textContent = pais.nombre; // Cambia 'nombre' por la propiedad correspondiente
                    selectPaisProfesor.appendChild(option.cloneNode(true));
                    selectPaisAlumno.appendChild(option);
                });
            } catch (error) {
                console.error('Error al cargar los países:', error);
            }
        }
    
        // Función para cargar las materias en el select
        async function cargarMaterias() {
    try {
        const response = await fetch('https://learn-hub-eta.vercel.app/Materia');
        
        if (!response.ok) {
            throw new Error('Error en la respuesta del servidor');
        }

        const materias = await response.json();

        // Check if the response is an array
        if (!Array.isArray(materias)) {
            throw new Error('La respuesta no es un array');
        }
        
        const selectMateriasProfesor = document.getElementById('materias_profesor');

        // Llenar el select de materias para profesores
        materias.forEach(materia => {
            const option = document.createElement('option');
            option.value = materia.id; // Asumiendo que el ID es la propiedad que necesitas
            option.textContent = materia.nombre; // Cambia 'nombre' por la propiedad correspondiente
            selectMateriasProfesor.appendChild(option);
        });
    } catch (error) {
        console.error('Error al cargar las materias:', error);
    }
}
        document.getElementById('registerForm').addEventListener('submit', function (e) {
            e.preventDefault();
        
            // Obtener valores del formulario principal
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const tipoUsuario = document.querySelector('input[name="role"]:checked').value;
        
            // Validar que las contraseñas coincidan
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden.');
                return;
            }
        
            // Crear objeto con los datos principales del usuario
            const data = {
                nombre,
                apellido,
                email,
                password,
                confirmPassword,
                tipoUsuario
            };
        
            // Mostrar formulario adicional según el tipo de usuario
            if (tipoUsuario === 'profesor') {
                document.querySelector('.datos-profesor').style.display = 'block';
                document.querySelector('.container').style.display = 'none';
            } else if (tipoUsuario === 'alumno') {
                document.querySelector('.datos-alumno').style.display = 'block';
                document.querySelector('.container').style.display = 'none';
            }
        
            // Asignar evento al formulario adicional del profesor
            document.getElementById('formProfesor').onsubmit = async function (e) {
                e.preventDefault();
                const datosProfesor = obtenerDatosProfesor();
                await enviarDatosRegistro(data, datosProfesor, 'profesor');
            };
        
            // Asignar evento al formulario adicional del alumno
            document.getElementById('formAlumno').onsubmit = async function (e) {
                e.preventDefault();
                const datosAlumno = obtenerDatosAlumno();
                await enviarDatosRegistro(data, datosAlumno, 'alumno');
            };
        });
        
        // Obtener los datos adicionales del formulario de profesor
        function obtenerDatosProfesor() {
            return {
                fecha_de_nacimiento: document.getElementById('fecha_de_nacimiento_profesor').value,
                telefono: document.getElementById('telefono_profesor').value,
                pais: document.getElementById('pais_profesor').value,
                materias: document.getElementById('materias_profesor').value,
                certificadoestudio: document.getElementById('certificadoestudio_profesor').files[0],
                foto: document.getElementById('foto_profesor').files[0]
            };
        }
        
        // Obtener los datos adicionales del formulario de alumno
        function obtenerDatosAlumno() {
            return {
                fecha_de_nacimiento: document.getElementById('fecha_de_nacimiento_alumno').value,
                telefono: document.getElementById('telefono_alumno').value,
                pais: document.getElementById('pais_alumno').value,
                colegio: document.getElementById('colegio_alumno').value,
                foto: document.getElementById('foto_alumno').files[0]
            };
        }
        
        // Función para enviar los datos de registro
        async function enviarDatosRegistro(data, datosExtra, tipoUsuario) {
            try {
                console.log('Enviando datos de registro:', data);
        
                // Crear objeto FormData para enviar los datos del formulario adicional
                const formData = new FormData();
        
                // Añadir los datos principales
                for (const key in data) {
                    formData.append(key, data[key]);
                }
        
                // Append de los datos extra de alumno o profesor
                for (const key in datosExtra) {
                    formData.append(key, datosExtra[key]);
                }
        
                // Console log del formdata (sin mostrar el contenido de archivos)
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}: ${value}`);
                }
        
                // URL de la API
                const url = 'https://learn-hub-eta.vercel.app/auth/register';
        
                // Fetchear los datos
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
        
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error en el registro:', errorText);
                    throw new Error('Error en el registro');
                }
        
                alert('Registro exitoso');
            } catch (error) {
                console.error('Error al enviar los datos:', error);
                alert(`Hubo un problema con el registro: ${error.message}`);
            }
        }
    
        // Llamar a las funciones al cargar la página
        document.addEventListener('DOMContentLoaded', () => {
            cargarPaises();
            cargarMaterias();
        });
    </script>
    
           
</body>
</html>