<!DOCTYPE html> 
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Configuración</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="stylish.css">
    <link rel="icon" href="Images html/logo pestaña.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
</head>

<body>
    <header class="header">
        <!-- Header content -->
    </header>

    <main class="mainfondobasico">
        <div class="Proximasclases">
            <!-- Próximas clases content -->
        </div>
        <div id="calendar"></div>
    </main>

    <script>
        // Función para obtener las reservas de un alumno
        async function getReservasByAlumno(IDalumno) {
            try {
                const response = await fetch(`https://learn-hub-eta.vercel.app/reservaciones/alumno/${IDalumno}`);
                if (response.ok) {
                    return await response.json();
                } else {
                    console.error('Error al obtener las reservas del alumno:', response.statusText);
                    alert('Hubo un error al obtener las reservas.');
                }
            } catch (error) {
                console.error('Error en la solicitud fetch:', error);
                alert('Hubo un error con la conexión.');
            }
        }

        // Función para obtener las reservas de un profesor
        async function getReservasByProfesor(idprof) {
            try {
                const response = await fetch(`https://learn-hub-eta.vercel.app/reservaciones/profesor/${idprof}`);
                if (response.ok) {
                    return await response.json();
                } else {
                    console.error('Error al obtener las reservas del profesor:', response.statusText);
                    alert('Hubo un error al obtener las reservas.');
                }
            } catch (error) {
                console.error('Error en la solicitud fetch:', error);
                alert('Hubo un error con la conexión.');
            }
        }

        // Configurar el calendario
        document.addEventListener('DOMContentLoaded', async function() {
            const calendarEl = document.getElementById('calendar');
            const idprof = '456';  // Reemplazar con el ID del profesor
            const IDalumno = '789'; // Reemplazar con el ID del alumno, si se requiere

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: async function(fetchInfo, successCallback, failureCallback) {
                    try {
                        const reservas = await getReservasByProfesor(idprof); // Si quieres usar alumno, cambia por getReservasByAlumno(IDalumno)
                        const eventos = reservas.map(reserva => ({
                            title: `Clase con ${reserva.alumnoNombre}`,
                            start: reserva.fechaInicio,
                            end: reserva.fechaFin
                        }));
                        successCallback(eventos);
                    } catch (error) {
                        console.error('Error al cargar los eventos:', error);
                        failureCallback(error);
                    }
                }
            });

            calendar.render();
        });
    </script>
</body>
</html>
