<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Calendario</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="stylish.css">
    <link rel="icon" href="Images html/logo pestaña.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
</head>

<body>
    <header class="header">
        <img class="logoarriba" src="Images html/LOGOLH.png" alt="Learn Hub">
        <div class="search">
            <input type="search" name="Buscar" id="búsqueda" placeholder="Buscar">
            <button id="header-search" class="buttonsearch" onclick="buscaralumno()"><i class="fas fa-search"></i></button>
        </div>

        <nav class="navbar">
            <ul>
                <li class="boton-inicio"><button class="inicio" onclick="window.location.href='home.html'"><img src="Images html/logo inicio.png" alt=""></button><a href="home.html">Inicio</a></li>
                <li class="boton-perfil-alumno"><button onclick="window.location.href='perfil.html'"><img src="Images html/logo perfil alumno.png" alt=""></button><a href="perfil.html">Perfil</a></li>
                <li class="boton-mis-profesores"><button onclick="window.location.href='misprofesores.html'"><img src="Images html/logo mis profesores.png" alt=""></button><a href="misprofesores.html">Mis profesores</a></li>
                <li class="boton-calendario"><button onclick="window.location.href='calendario.html'"><img src="Images html/logo calendario.png" alt=""></button><a href="calendario.html">Calendario</a></li>
                <li class="boton-configuracion"><button onclick="window.location.href='configuracion.html'"><img src="Images html/logo configuracion.png" alt=""></button><a href="configuracion.html">Configuración</a></li>
                <li class="boton-configuracion"><button onclick="window.location.href='chat.html'"><img src="Images html/logo mensajes.png" alt=""></button><a href="chat.html">Mensajes</a></li>
                <li class="boton-configuracion"><button onclick="window.location.href='reservaciones.html'"><img src="Images html/logo reservaciones.png" alt=""></button><a href="reservaciones.html">Reservaciones</a></li>
            </ul>
        </nav>
        <button id="menubutton"><img src="Images html/menubutton.png" alt="MENU"></button>
        <nav class="menu" id="menu">
            <ul>
                <li><a href="home.html">Inicio</a></li>
                <li><a href="perfil.html">Perfil</a></li>
                <li><a href="misprofesores.html">Mis profesores</a></li>
                <li><a href="calendario.html">Calendario</a></li>
                <li><a href="configuracion.html">Configuración</a></li>
                <li><a href="chat.html">Mensajes</a></li>
                <li><a href="reservaciones.html">Reservaciones</a></li>
            </ul>
        </nav>
    </header>

    <main class="mainfondobasico">
        <div class="Proximasclases">
            <h1>Próximas Clases</h1>
            <p>Lunes 1/10</p>
            <p>15:00-16:30</p>
            <p>Clase con Ezequiel Agradnik</p>
            <p>18:00-19:00</p>
            <p>Clase con Sergio Coppa</p>
            <p>Viernes 4/10</p>
            <p>16:00-17:00</p>
            <p>Clase con Martín Melman</p>
            <p>15:00-16:00</p>
            <p>Clase con Sergio Coppa</p>
        </div>
        <div id="calendar"></div>
    </main>

    <script>
        async function getReservasByProfesor(idprof, idalumno) {
            try {
                const response = await fetch(`https://learn-hub-eta.vercel.app/reservaciones/IDalumno/${idalumno}`);
                if (response.ok) {
                    return await response.json();
                } else {
                    console.error('Error al obtener las reservas del profesor:', response.statusText);
                    alert('Hubo un error al obtener las reservas.');
                    return [];
                }
            } catch (error) {
                console.error('Error en la solicitud fetch:', error);
                alert('Hubo un error con la conexión.');
                return [];
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const calendarEl = document.getElementById('calendar');
            const idprof = '60';
            const idalumno = '123'; // Definir el ID del alumno aquí

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: async function(fetchInfo, successCallback, failureCallback) {
                    try {
                        const reservas = await getReservasByProfesor(idprof, idalumno);
                        if (!reservas || !Array.isArray(reservas)) {
                            console.error('Reservas no válidas:', reservas);
                            failureCallback(new Error('Reservas no válidas'));
                            return;
                        }

                        const eventos = reservas.map(reserva => ({
                            title: `Clase con ${reserva.profesorNombre}`,
                            start: reserva.fechaInicio,
                            end: reserva.fechaFin,
                            extendedProps: {
                                profesorNombre: reserva.profesorNombre,
                                hora: reserva.hora,
                                descripcion: reserva.descripcion
                            }
                        }));
                        successCallback(eventos);
                    } catch (error) {
                        console.error('Error al cargar los eventos:', error);
                        failureCallback(error);
                    }
                },
                eventContent: function(arg) {
                    const profesorNombre = arg.event.extendedProps.profesorNombre;
                    const hora = arg.event.extendedProps.hora;
                    const descripcion = arg.event.extendedProps.descripcion;

                    const divEl = document.createElement('div');
                    divEl.classList.add('reserva-evento');
                    divEl.innerHTML = `
                        <strong>Clase con: ${profesorNombre}</strong><br>
                        <span>${hora}</span>
                    `;

                    const detalleDiv = document.createElement('div');
                    detalleDiv.classList.add('reserva-detalle');
                    detalleDiv.innerHTML = `
                        <p>Descripción: ${descripcion}</p>
                    `;
                    divEl.appendChild(detalleDiv);

                    return { domNodes: [divEl] };
                }
            });

            calendar.render();
        });
    </script>
</body>
</html>
