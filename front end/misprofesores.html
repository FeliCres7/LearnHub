<!DOCTYPE html>
<html lang="es">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Mis profesores</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="Images html/logo pestaña.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header class="header">
        <img class="logoarriba" src="Images html/LOGOLH.png" alt="Learn Hub">
        <div class="search">
            <input type="search" id="búsqueda" placeholder="Buscar">
            <button class="buttonsearch"><i class="fas fa-search"></i></button>
        </div>

        <nav class="navbar">
            <ul>
                <li class="boton-inicio"><button class="inicio" onclick="window.location.href='home.html'"><img src="Images html/logo inicio.png" alt=""></button><a href="home.html">Inicio</a></li>
                <li class="boton-perfil-alumno"><button onclick="window.location.href='perfil.html'"><img src="Images html/logo perfil alumno.png" alt=""></button><a href="perfil.html">Perfil</a></li>
                <li class="boton-mis-profesores"><button onclick="window.location.href='misprofesores.html'"><img src="Images html/logo mis profesores.png" alt=""></button><a href="misprofesores.html">Mis profesores</a></li>
                <li class="boton-calendario"><button onclick="window.location.href='calendario.html'"><img src="Images html/logo calendario.png" alt=""></button><a href="calendario.html">Calendario</a></li>
                <li class="boton-configuracion"><button onclick="window.location.href='configuracion.html'"><img src="Images html/logo configuracion.png" alt=""></button><a href="configuracion.html">Configuración</a></li>
            </ul>
        </nav>
        <button id="menubutton"><img src="Images html/menubutton.png" alt="MENU"></button>
        <nav class="menu" id="menu">
            <ul>
                <li><a href="home.html">Inicio</a></li>
                <li><a href="perfil.html">Perfil</a></li>
                <li><a href="misprofesores.html">Mis profesores</a></li>
                <li><a href="calendario.html">Calendario</a></li>
                <li><a href="configuracion.html">Configuración</a></li>
            </ul>
        </nav>
    </header>
    <script src="script.js"></script>

    <main class="main-misprofesores">
        <aside class="aside-misprofesores">
            <div class="header-filtrar-profesores">
                <p>Filtrar</p>
                <img src="Images html/logo filtrar.png" alt="">
            </div>
            <div class="filtrar-profesores">
                <p>Nombre</p>
                <input type="search" id="inputNombre" placeholder="Buscar por nombre">
                <button id="filtrar-nombre" class="filtrar-button">Filtrar</button>
                <p>Materias</p>
                <select name="" id="selectmaterias"></select>
                <button id="filtrar-materia" class="filtrar-button">Filtrar</button>
                <p>Fechas</p>
                <ul>
                    <li>Lunes</li>
                    <li>Martes</li>
                    <li>Miércoles</li>
                    <li>Jueves</li>
                    <li>Viernes</li>
                    <li>Sábado</li>
                    <li>Domingo</li>
                </ul>
                <button id="filtrar-fechas" class="filtrar-button">Filtrar</button>
            </div>
        </aside>
        <section id="lista-misprofesores" class="lista-misprofesores"></section>
        <aside class="aside-misprofesores"></aside>
    </main>
    <footer><img src="Images html/LogoLH.png" alt=""></footer>
</body>

<script>
    const mainCards = document.getElementById("lista-misprofesores");

function CreateProfCard(prof) {
    return `
    <div class="profesor-misprofesores">
        <p class="name-profesor">${prof.nombre} ${prof.apellido}</p>
        <div class="content-profesor">
            <img class="fotomisprofesores" src="${prof.foto || 'default_foto.png'}" alt="Foto del profesor">
            <div class="datos-profesor">
                <div class="datacontainer">
                    <p class="bold">Materia:</p>
                    <p>${prof.idmateria || 'No disponible'}</p>
                </div>
                <div class="datacontainer">
                    <p class="bold">Días:</p>
                    <p>${prof.dias || 'No disponible'}</p>
                </div>
                <div class="datacontainer">
                    <p class="bold">Horarios:</p>
                    <p>${prof.disponibilidad_horaria || 'No disponible'}</p>
                </div>
            </div>
            <div class="botones-profesor">
                <button onclick="window.location.href='materialesdetrabajo.html'">Materiales de trabajo</button>
                <button>Ir a perfil</button>
                <button>Ver datos de contacto</button>
            </div>
            <div class="valoracion-profesor">
                <p class="bold">Valoración</p>
                <div class="stars" data-valoracion="${prof.valoracion || 0}">
                    <img src="Images html/estrella vacia.png" alt="">
                    <img src="Images html/estrella vacia.png" alt="">
                    <img src="Images html/estrella vacia.png" alt="">
                    <img src="Images html/estrella vacia.png" alt="">
                    <img src="Images html/estrella vacia.png" alt="">
                </div>
            </div>
        </div>
    </div>`;
}

async function fetchProfesores(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Error al obtener los profesores. Código: ' + response.status);
        }
        return await response.json();
    } catch (error) {
        console.error(error);
        alert(error.message);
        return []; // Retorna un array vacío en caso de error
    }
}

async function cargarProfesores() {
    const profesores = await fetchProfesores("https://learn-hub-eta.vercel.app/profesores");
    renderizarProfesores(profesores);
}

function renderizarProfesores(data) {
    mainCards.innerHTML = "";
    if (data.length === 0) {
        mainCards.innerHTML = "<p>No se encontraron profesores.</p>";
        return;
    }
    data.forEach((profesor) => {
        const item = CreateProfCard(profesor);
        mainCards.innerHTML += item;
    });
}

function asignarValoraciones() {
    const images = [
        'Images html/estrella vacia.png',   // 0
        'Images html/Media estrella.png',   // 1
        'Images html/estrella completa.png' // 2
    ];

    document.querySelectorAll('.stars').forEach(starContainer => {
        let valoracion = parseFloat(starContainer.getAttribute('data-valoracion')) || 0;
        valoracion = Math.round(valoracion / 2);
        const starImages = starContainer.querySelectorAll('img');

        starImages.forEach((img, index) => {
            if (valoracion >= index + 1) {
                img.src = images[2]; // Estrella completa
            } else if (valoracion >= index + 0.5) {
                img.src = images[1]; // Media estrella
            } else {
                img.src = images[0]; // Estrella vacía
            }
        });
    });
}

async function cargarMaterias() {
    try {
        const response = await fetch("https://learn-hub-eta.vercel.app/Materia");
        if (!response.ok) throw new Error("Error al cargar las materias");
        const materias = await response.json();
        const select = document.getElementById("selectmaterias");
        select.innerHTML = '<option value="">Todas las materias</option>'; // Opción por defecto

        materias.forEach(materia => {
            const option = document.createElement("option");
            option.value = materia.id; // Asegúrate de que aquí estás usando el ID correcto
            option.textContent = materia.nombre_materia; // Nombre de la materia
            select.appendChild(option);
        });
    } catch (error) {
        console.error(error);
        alert(error.message);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    cargarProfesores();
    cargarMaterias();
});

document.getElementById('filtrar-nombre').addEventListener('click', () => {
    const nombre = document.getElementById("inputNombre").value.toLowerCase();
    const profesoresFiltrados = [...document.querySelectorAll('.profesor-misprofesores')].filter(profesor => 
        profesor.querySelector('.name-profesor').textContent.toLowerCase().includes(nombre)
    );
    mainCards.innerHTML = "";
    profesoresFiltrados.forEach(profesor => mainCards.appendChild(profesor));
});

document.getElementById('filtrar-materia').addEventListener('click', async () => {
    const materiaSeleccionada = document.getElementById("selectmaterias").value;
    console.log("Materia seleccionada:", materiaSeleccionada); // Imprimir en consola para depuración

    const url = materiaSeleccionada ? 
        `https://learn-hub-eta.vercel.app/profesores?materia=${materiaSeleccionada}` : 
        "https://learn-hub-eta.vercel.app/profesores";

    const profesoresFiltrados = await fetchProfesores(url);

    if (profesoresFiltrados.length === 0) {
        console.warn("No se encontraron profesores para la materia seleccionada."); // Mensaje de advertencia
    }

    renderizarProfesores(profesoresFiltrados);
});

</script>

</html>
